webpackJsonp([3],{Cy98:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("3cXf"),r=n.n(i),a=n("IHPB"),s=n.n(a),c=n("4YfN"),o=n.n(c),l=n("b8UZ"),u={name:"cart",data:function(){return{cartList:[],multipleSelection:[],productids:[],currentPage:1,pageSize:5,cartList2:[],rowKeys:this.$ut.uuid()}},computed:o()({},Object(l.c)(["user"])),methods:{getRowKeys:function(t){return t.productid},sliceFn:function(){var t=(this.currentPage-1)*this.pageSize,e=this.currentPage*this.pageSize;this.cartList2=this.cartList.slice(t,e)},handleSizeChange:function(t){console.log("每页 "+t+" 条"),this.sliceFn()},handleCurrentChange:function(t){console.log("当前页: "+t),this.sliceFn()},handleSelectionChange:function(t){var e=this;this.multipleSelection=t,console.log(t),this.productids=[],this.multipleSelection.forEach(function(t){e.productids.push(t.productid)})},makeOrderFn:function(){var t=this,e={userid:this.user.id,productList:[].concat(s()(this.multipleSelection))},n=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.5)"});this.$axios.post("shop/order/addOrder",r()(e)).then(function(e){n.close(),e&&"20000"===e.resultCode?(t.$notify({message:"订单生成成功。",type:"success"}),t.$router.push({path:"ordersDetails",query:{orderid:e.result.orderid}})):t.$notify({message:"订单生成失败。",type:"warning"})}).catch(function(e){n.close(),t.$notify({message:"订单生成接口报错。",type:"warning"})})},deleteFn:function(t){var e=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var n={productids:[].concat(s()(t)),userid:e.user.id};"clear"===t&&(n.productids=[],e.cartList.forEach(function(t){n.productids.push(t.productid)}));var i=e.$loading({lock:!0,background:"rgba(0, 0, 0, 0.5)"});e.$axios.post("shop/cart/deleteCart",r()(n)).then(function(t){i.close(),t&&"20000"===t.resultCode?(e.getCartList(),e.multipleSelection=[],e.productids=[],e.rowKeys=e.$ut.uuid(),e.$notify({message:"删除成功。",type:"success"})):e.$notify({message:"删除失败。",type:"warning"})}).catch(function(t){i.close(),e.$notify({message:"删除接口报错。",type:"warning"})})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},getCartList:function(){var t=this,e="shop/cart/getCartList/"+this.user.id,n=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.5)"});this.$axios.get(e).then(function(e){n.close(),e&&"20000"===e.resultCode?(t.cartList=e.result,t.cartList.length<5&&(t.currentPage=1),t.$nextTick(function(){t.sliceFn()})):t.$notify({message:"获取购物车列表失败。",type:"warning"})}).catch(function(e){n.close(),t.$notify({message:"获取购物车列表接口报错。",type:"warning"})})}},mounted:function(){},created:function(){this.getCartList()}},d=n("W5g0"),p=Object(d.a)(u,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"articleBox fx-f1"},[n("div",{staticClass:"mb20 clx"},[n("el-button",{attrs:{type:"primary",disabled:!t.multipleSelection.length},on:{click:t.makeOrderFn}},[t._v("提交订单")]),t._v(" "),n("el-button",{attrs:{type:"primary",disabled:!t.multipleSelection.length},on:{click:function(e){return t.deleteFn(t.productids)}}},[t._v("删除选中的商品")]),t._v(" "),n("el-button",{staticClass:"right",attrs:{disabled:!t.cartList.length,type:"primary"},on:{click:function(e){return t.deleteFn("clear")}}},[t._v("清空购物车")])],1),t._v(" "),n("el-table",{key:t.rowKeys,staticClass:"articleList",attrs:{data:t.cartList2,"row-key":t.getRowKeys,border:""},on:{"selection-change":t.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection","reserve-selection":!0,width:"55"}}),t._v(" "),n("el-table-column",{attrs:{label:"图片",width:"72"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticClass:"productIcon"},[n("img",{attrs:{src:t.$ut.srcUrl+e.row.image,sizes:"48"}})])]}}])}),t._v(" "),n("el-table-column",{attrs:{prop:"cname",label:"名称"}}),t._v(" "),n("el-table-column",{attrs:{prop:"category",label:"分类"}}),t._v(" "),n("el-table-column",{attrs:{prop:"descn",label:"描述"}}),t._v(" "),n("el-table-column",{attrs:{prop:"listprice",label:"单价(￥)"}}),t._v(" "),n("el-table-column",{attrs:{label:"数量"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-input-number",{attrs:{min:1,size:"small",label:"描述文字"},model:{value:e.row.quantity,callback:function(n){t.$set(e.row,"quantity",n)},expression:"scope.row.quantity"}})]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"总价(￥)"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.row.listprice*e.row.quantity)+"\n      ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{type:"text"},on:{click:function(n){return t.deleteFn([e.row.productid])}}},[t._v("删除")])]}}])})],1),t._v(" "),n("el-pagination",{attrs:{"current-page":t.currentPage,"page-size":t.pageSize,layout:"total, prev, pager, next",total:t.cartList.length},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}})],1)},[],!1,null,null,null);e.default=p.exports}});
//# sourceMappingURL=3.cd6d7fff44ffa9747680.js.map